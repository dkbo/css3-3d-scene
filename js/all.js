"use strict";function Store(){this.perspective=800,this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.r_left=!1,this.r_right=!1,this.r_up=!1,this.r_down=!1,this.posX=-400,this.posY=400,this.rotateX=0,this.rotateY=0,this.moveSpeed=24,this.retrunSpeed=1,this.PI=Math.PI/180}var requestAFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),cancelAFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(t){window.clearTimeout(t)}}(),ClickRenderer={init:function(t,e,i,s){this.store=s,this.scene=t,this.camera=e,this.fps=i,window.addEventListener("render_move",this),window.addEventListener("render_rotate",this)},handleEvent:function(t){switch(t.type){case"render_move":this.fps.style.transform="translate3D("+t.detail.x+"px, 0, "+t.detail.y+"px) rotateX(0deg) rotateY(0deg) rotateZ(0deg)";break;case"render_rotate":this.camera.style.transform="translate3D(0, 0, "+this.store.perspective+"px) rotateX("+t.detail.y+"deg) rotateY("+t.detail.x+"deg) rotateZ(0deg)"}}};Store.prototype={init:function(){window.addEventListener("set_move",this),window.addEventListener("cancel_move",this),requestAFrame(this._move.bind(this))},handleEvent:function(t){switch(t.type){case"set_move":switch(t.detail){case 65:this.r_left=!0;break;case 37:this.r_left=!0;break;case 68:this.r_right=!0;break;case 39:this.r_right=!0;break;case 87:this.forward=!0;break;case 38:this.forward=!0;break;case 83:this.backward=!0;break;case 40:this.backward=!0;break;case 81:this.left=!0;break;case 69:this.right=!0}break;case"cancel_move":switch(t.detail){case 65:this.r_left=!1;break;case 37:this.r_left=!1;break;case 68:this.r_right=!1;break;case 39:this.r_right=!1;break;case 87:this.forward=!1;break;case 38:this.forward=!1;break;case 83:this.backward=!1;break;case 40:this.backward=!1;break;case 81:this.left=!1;break;case 69:this.right=!1}}},_move:function(){this.forward|this.backward|this.left|this.right&&(this.left?(this.posX+=Math.sin((this.rotateX+90)*this.PI)*this.moveSpeed,this.posY-=Math.cos((this.rotateX+90)*this.PI)*this.moveSpeed):this.right&&(this.posX-=Math.sin((this.rotateX+90)*this.PI)*this.moveSpeed,this.posY+=Math.cos((this.rotateX+90)*this.PI)*this.moveSpeed),this.forward?(this.posX-=Math.sin(this.rotateX*this.PI)*this.moveSpeed,this.posY+=Math.cos(this.rotateX*this.PI)*this.moveSpeed):this.backward&&(this.posX+=Math.sin(this.rotateX*this.PI)*this.moveSpeed,this.posY-=Math.cos(this.rotateX*this.PI)*this.moveSpeed),this._setMove(this.posX,this.posY)),this.r_left|this.r_right|this.r_top|this.r_down&&(this.r_left?this.rotateX-=this.retrunSpeed:this.r_right&&(this.rotateX+=this.retrunSpeed),this.r_up?this.rotateY+=this.retrunSpeed:this.r_down&&(this.rotateY-=this.retrunSpeed),this._setRotate(this.rotateX,this.rotateY)),requestAFrame(this._move.bind(this))},_setMove:function(t,e){window.dispatchEvent(new CustomEvent("render_move",{detail:{x:t,y:e}}))},_setRotate:function(t,e){window.dispatchEvent(new CustomEvent("render_rotate",{detail:{x:t,y:e}}))}};var Dispatcher={init:function(){this.scene=document.getElementById("scene"),this.camera=document.getElementById("camera"),this.fps=document.getElementById("fps"),window.addEventListener("keydown",this),window.addEventListener("keyup",this),this.store=new Store,this.store.init(),ClickRenderer.init(this.scene,this.camera,this.fps,this.store)},handleEvent:function(t){switch(t.type){case"keydown":window.dispatchEvent(new CustomEvent("set_move",{detail:t.keyCode}));break;case"keyup":window.dispatchEvent(new CustomEvent("cancel_move",{detail:t.keyCode}))}}};Dispatcher.init();